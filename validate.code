import "utils/pack/pack128.code" as pack128
import "utils/pack/unpack128.code" as unpack128
import "hashes/sha256/1024bit.code" as sha256for1024
import "./sha256only.code" as sha256only
import "./getHexLength.code" as getHexLength

def toBigEndian(field[32] value) -> (field[32]):
    return [ \
            ...value[24..32], \
            ...value[16..24], \
            ...value[8..16], \
            ...value[0..8]]

def toBigEndian(field[24] value) -> (field[24]):
    return [ \
            ...value[16..24], \
            ...value[8..16], \
            ...value[0..8]]

def toBigEndian(field[128] value) -> (field[128]):
    return [ \
            ...value[120..128], \
            ...value[112..120], \
            ...value[104..112], \
            ...value[96..104], \
            ...value[88..96], \
            ...value[80..88], \
            ...value[72..80], \
            ...value[64..72], \
            ...value[56..64], \
            ...value[48..56], \
            ...value[40..48], \
            ...value[32..40], \
            ...value[24..32], \
            ...value[16..24], \
            ...value[8..16], \
            ...value[0..8]]

def packMaxVariance(field length) -> (field):
    field result = 0
    result = if length == 1 then pack128([...[0; 124], ...[1; 4]]) else result fi
    result = if length == 2 then pack128([...[0; 120], ...[1; 8]]) else result fi
    result = if length == 3 then pack128([...[0; 116], ...[1; 12]]) else result fi
    result = if length == 4 then pack128([...[0; 112], ...[1; 16]]) else result fi
    result = if length == 5 then pack128([...[0; 108], ...[1; 20]]) else result fi
    result = if length == 6 then pack128([...[0; 104], ...[1; 24]]) else result fi
    result = if length == 7 then pack128([...[0; 100], ...[1; 28]]) else result fi
    result = if length == 8 then pack128([...[0; 96], ...[1; 32]]) else result fi
    result = if length == 9 then pack128([...[0; 92], ...[1; 36]]) else result fi
    result = if length == 10 then pack128([...[0; 88], ...[1; 40]]) else result fi
    result = if length == 11 then pack128([...[0; 84], ...[1; 44]]) else result fi
    result = if length == 12 then pack128([...[0; 80], ...[1; 48]]) else result fi
    result = if length == 13 then pack128([...[0; 76], ...[1; 52]]) else result fi
    result = if length == 14 then pack128([...[0; 72], ...[1; 56]]) else result fi
    result = if length == 15 then pack128([...[0; 68], ...[1; 60]]) else result fi
    result = if length == 16 then pack128([...[0; 64], ...[1; 64]]) else result fi
    result = if length == 17 then pack128([...[0; 60], ...[1; 68]]) else result fi
    result = if length == 18 then pack128([...[0; 56], ...[1; 72]]) else result fi
    result = if length == 19 then pack128([...[0; 52], ...[1; 76]]) else result fi
    result = if length == 20 then pack128([...[0; 48], ...[1; 80]]) else result fi
    result = if length == 21 then pack128([...[0; 44], ...[1; 84]]) else result fi
    result = if length == 22 then pack128([...[0; 40], ...[1; 88]]) else result fi
    result = if length == 23 then pack128([...[0; 36], ...[1; 92]]) else result fi
    result = if length == 24 then pack128([...[0; 32], ...[1; 96]]) else result fi
    result = if length == 25 then pack128([...[0; 28], ...[1; 100]]) else result fi
    result = if length == 26 then pack128([...[0; 24], ...[1; 104]]) else result fi
    result = if length == 27 then pack128([...[0; 20], ...[1; 108]]) else result fi
    result = if length == 28 then pack128([...[0; 16], ...[1; 112]]) else result fi
    result = if length == 29 then pack128([...[0; 12], ...[1; 116]]) else result fi
    result = if length == 30 then pack128([...[0; 8], ...[1; 120]]) else result fi
    result = if length == 31 then pack128([...[0; 4], ...[1; 124]]) else result fi
    result = if length == 32 then pack128([1; 128]) else result fi
return result

def packTarget(field[32] bits) -> (field):
    field result = \
    if pack128([...[0; 120], ...bits[0..8]]) == 23 then pack128([...[0; 72], ...bits[8..32], ...[0; 32]]) else \
      if pack128([...[0; 120], ...bits[0..8]]) == 24 then pack128([...[0; 64], ...bits[8..32], ...[0; 40]]) else \
        if pack128([...[0; 120], ...bits[0..8]]) == 25 then pack128([...[0; 56], ...bits[8..32], ...[0; 48]]) else \
          if pack128([...[0; 120], ...bits[0..8]]) == 26 then pack128([...[0; 48], ...bits[8..32], ...[0; 56]]) else \
            if pack128([...[0; 120], ...bits[0..8]]) == 27 then pack128([...[0; 40], ...bits[8..32], ...[0; 64]]) else \
              if pack128([...[0; 120], ...bits[0..8]]) == 28 then pack128([...[0; 32], ...bits[8..32], ...[0; 72]]) else \
                if pack128([...[0; 120], ...bits[0..8]]) == 29 then pack128([...[0; 24], ...bits[8..32], ...[0; 80]]) else \
                  if pack128([...[0; 120], ...bits[0..8]]) == 30 then pack128([...[0; 16], ...bits[8..32], ...[0; 88]]) else \
                    if pack128([...[0; 120], ...bits[0..8]]) == 31 then pack128([...[0; 8], ...bits[8..32], ...[0; 96]]) else \
                    pack128([0; 128]) fi \
                  fi \
                fi \
              fi \
            fi \
          fi \
        fi \
      fi \
    fi
return result

def get_bit_length_bits(field[24] bits) -> (field):
    field result = 0
    for field i in 0..24 do
        result = if (result == 0) && (bits[i] == 1) then 24-i else result fi
    endfor
return result

def get_hex_length_bits(field[24] bits) -> (field):
    field bit_length = get_bit_length_bits(bits)
    field result = 0
    result = if bit_length > 0 then 1 else result fi
    result = if bit_length > 4 then 2 else result fi
    result = if bit_length > 8 then 3 else result fi
    result = if bit_length > 12 then 4 else result fi
    result = if bit_length > 16 then 5 else result fi
    result = if bit_length > 20 then 6 else result fi
return result

// call with last field of block array
def validate_target(field epoch_head, field epoch_tail, field next_epoch_head) -> (field[2]):
    epoch_head_unpacked = unpack128(epoch_head)
    epoch_tail_unpacked = unpack128(epoch_tail)
    next_epoch_head_unpacked = unpack128(next_epoch_head)
    time_head = pack128([...[0; 96], ...toBigEndian(epoch_head_unpacked[32..64])])
    time_tail = pack128([...[0; 96], ...toBigEndian(epoch_tail_unpacked[32..64])])

    current_target = packTarget(toBigEndian(epoch_head_unpacked[64..96]))
    field time_delta = time_tail - time_head
    field target_time_delta = 1209600 // 2016 * 600 (time interval of 10 minutes)

    field target = current_target * time_delta // target_time_delta

    field encoded_target = packTarget(toBigEndian(next_epoch_head_unpacked[64..96]))
    field encoded_target_extended = encoded_target * target_time_delta

    // The encoding of targets uses a floor function, the comparison of a calculated target may therefore fail
    // Therefore, a maximum variance is calculated that is one hex digit in the encoding
    field maxVariance = packMaxVariance(getHexLength(target)-get_hex_length_bits(toBigEndian(next_epoch_head_unpacked[64..88])))
    // int('ffff' + 10 * '00', 16) * 2016 * 600 = 95832923060582736897701037735936000
    target = if target > 95832923060582736897701037735936000 then 95832923060582736897701037735936000 else target fi
    field delta = target - encoded_target_extended
    delta = if target >= encoded_target_extended then delta else maxVariance + 1 fi
    field valid = if delta <= maxVariance then 1 else 0 fi
    //field valid = if (37202390668975264121251936602161152-81015268229227203625641762304819200) < 1267650600228229401496703205375 then 1 else 0 fi
return [valid, currentTarget]

def hash_block_header(field[5] preimage) -> (field[2]):
    a = unpack128(preimage[0])
    b = unpack128(preimage[1])
    c = unpack128(preimage[2])
    d = unpack128(preimage[3])
    e = unpack128(preimage[4])

    field[256] preimage1 = [...a, ...b]
    field[256] preimage2 = [...c, ...d]
    field[256] preimage3 = [...[...e, 1], ...[0; 127]]
    field[256] dummy = [...[0; 246], ...[1, 0, 1, 0, 0, 0, 0, 0, 0, 0]] //second array indicates length of preimage = 640bit

    intermediary = sha256for1024(preimage1, preimage2, preimage3, dummy)

    r = sha256only(intermediary)

    res0 = pack128(r[0..128])
    res1 = pack128(r[128..256])

return [res0, res1]


def validate_block_header(field reference_target, field[2] prev_block_hash, field[5] preimage) -> (field[3]):
	a = unpack128(preimage[0])
	b = unpack128(preimage[1])
	c = unpack128(preimage[2])
	d = unpack128(preimage[3])
	e = unpack128(preimage[4])

    encoded_prev_block_hash1 = pack128([...a[32..128], ...b[0..32]])
    encoded_prev_block_hash2 = pack128([...b[32..128], ...c[0..32]])
    field valid = if encoded_prev_block_hash1 == prev_block_hash[0] && encoded_prev_block_hash2 == prev_block_hash[1] \
        then 1 else 0 fi

    // converting to big endian is not necessary here, as reference target is encoded little endian
    field current_target = pack128([...[0; 96], ...e[64..96]])
    valid = if valid == 1 && current_target == reference_target then 1 else 0 fi

    field[256] preimage1 = [...a, ...b]
    field[256] preimage2 = [...c, ...d]
    field[256] preimage3 = [...[...e, 1], ...[0; 127]]
    field[256] dummy = [...[0; 246], ...[1, 0, 1, 0, 0, 0, 0, 0, 0, 0]] //second array indicates length of preimage = 640bit

    intermediary = sha256for1024(preimage1, preimage2, preimage3, dummy)

    r = sha256only(intermediary)

    res0 = pack128(r[0..128])
    res1 = pack128(r[128..256])

    target = packTarget(toBigEndian(e[64..96]))

    valid = if valid == 1 && target > pack128(toBigEndian(r[128..256])) then 1 else 0 fi

return [valid, res0, res1]
//return [valid, target, pack128(toBigEndian(r[128..256]))] //output for test purposes


def main(field[5] first_block_epoch, field[2] prev_block_hash, private field[2515] intermediate_blocks, field[5] final_block) -> (field[5]):
    unpacked_raw_target = unpack128(first_block_epoch[4])
    // converting to big endian is not necessary here, as it is compared to a little endian encoding
    // it is not used for calculations
    field reference_target = pack128([...[0; 96], ...unpacked_raw_target[64..96]])
    field result = 1
    block1 = validate_block_header(reference_target, prev_block_hash, intermediate_blocks[0..5])
    result = if block1[0] == 0 || result == 0 then 0 else 1 fi
    block2 = validate_block_header(reference_target, block1[1..3], intermediate_blocks[5..10])
    result = if block2[0] == 0 || result == 0 then 0 else 1 fi
    block3 = validate_block_header(reference_target, block2[1..3], intermediate_blocks[10..15])
    result = if block3[0] == 0 || result == 0 then 0 else 1 fi
    block4 = validate_block_header(reference_target, block3[1..3], intermediate_blocks[15..20])
    result = if block4[0] == 0 || result == 0 then 0 else 1 fi
    block5 = validate_block_header(reference_target, block4[1..3], intermediate_blocks[20..25])
    result = if block5[0] == 0 || result == 0 then 0 else 1 fi
    block6 = validate_block_header(reference_target, block5[1..3], intermediate_blocks[25..30])
    result = if block6[0] == 0 || result == 0 then 0 else 1 fi
    block7 = validate_block_header(reference_target, block6[1..3], intermediate_blocks[30..35])
    result = if block7[0] == 0 || result == 0 then 0 else 1 fi
    block8 = validate_block_header(reference_target, block7[1..3], intermediate_blocks[35..40])
    result = if block8[0] == 0 || result == 0 then 0 else 1 fi
    block9 = validate_block_header(reference_target, block8[1..3], intermediate_blocks[40..45])
    result = if block9[0] == 0 || result == 0 then 0 else 1 fi
    block10 = validate_block_header(reference_target, block9[1..3], intermediate_blocks[45..50])
    result = if block10[0] == 0 || result == 0 then 0 else 1 fi
    block11 = validate_block_header(reference_target, block10[1..3], intermediate_blocks[50..55])
    result = if block11[0] == 0 || result == 0 then 0 else 1 fi
    block12 = validate_block_header(reference_target, block11[1..3], intermediate_blocks[55..60])
    result = if block12[0] == 0 || result == 0 then 0 else 1 fi
    block13 = validate_block_header(reference_target, block12[1..3], intermediate_blocks[60..65])
    result = if block13[0] == 0 || result == 0 then 0 else 1 fi
    block14 = validate_block_header(reference_target, block13[1..3], intermediate_blocks[65..70])
    result = if block14[0] == 0 || result == 0 then 0 else 1 fi
    block15 = validate_block_header(reference_target, block14[1..3], intermediate_blocks[70..75])
    result = if block15[0] == 0 || result == 0 then 0 else 1 fi
    block16 = validate_block_header(reference_target, block15[1..3], intermediate_blocks[75..80])
    result = if block16[0] == 0 || result == 0 then 0 else 1 fi
    block17 = validate_block_header(reference_target, block16[1..3], intermediate_blocks[80..85])
    result = if block17[0] == 0 || result == 0 then 0 else 1 fi
    block18 = validate_block_header(reference_target, block17[1..3], intermediate_blocks[85..90])
    result = if block18[0] == 0 || result == 0 then 0 else 1 fi
    block19 = validate_block_header(reference_target, block18[1..3], intermediate_blocks[90..95])
    result = if block19[0] == 0 || result == 0 then 0 else 1 fi
    block20 = validate_block_header(reference_target, block19[1..3], intermediate_blocks[95..100])
    result = if block20[0] == 0 || result == 0 then 0 else 1 fi
    block21 = validate_block_header(reference_target, block20[1..3], intermediate_blocks[100..105])
    result = if block21[0] == 0 || result == 0 then 0 else 1 fi
    block22 = validate_block_header(reference_target, block21[1..3], intermediate_blocks[105..110])
    result = if block22[0] == 0 || result == 0 then 0 else 1 fi
    block23 = validate_block_header(reference_target, block22[1..3], intermediate_blocks[110..115])
    result = if block23[0] == 0 || result == 0 then 0 else 1 fi
    block24 = validate_block_header(reference_target, block23[1..3], intermediate_blocks[115..120])
    result = if block24[0] == 0 || result == 0 then 0 else 1 fi
    block25 = validate_block_header(reference_target, block24[1..3], intermediate_blocks[120..125])
    result = if block25[0] == 0 || result == 0 then 0 else 1 fi
    block26 = validate_block_header(reference_target, block25[1..3], intermediate_blocks[125..130])
    result = if block26[0] == 0 || result == 0 then 0 else 1 fi
    block27 = validate_block_header(reference_target, block26[1..3], intermediate_blocks[130..135])
    result = if block27[0] == 0 || result == 0 then 0 else 1 fi
    block28 = validate_block_header(reference_target, block27[1..3], intermediate_blocks[135..140])
    result = if block28[0] == 0 || result == 0 then 0 else 1 fi
    block29 = validate_block_header(reference_target, block28[1..3], intermediate_blocks[140..145])
    result = if block29[0] == 0 || result == 0 then 0 else 1 fi
    block30 = validate_block_header(reference_target, block29[1..3], intermediate_blocks[145..150])
    result = if block30[0] == 0 || result == 0 then 0 else 1 fi
    block31 = validate_block_header(reference_target, block30[1..3], intermediate_blocks[150..155])
    result = if block31[0] == 0 || result == 0 then 0 else 1 fi
    block32 = validate_block_header(reference_target, block31[1..3], intermediate_blocks[155..160])
    result = if block32[0] == 0 || result == 0 then 0 else 1 fi
    block33 = validate_block_header(reference_target, block32[1..3], intermediate_blocks[160..165])
    result = if block33[0] == 0 || result == 0 then 0 else 1 fi
    block34 = validate_block_header(reference_target, block33[1..3], intermediate_blocks[165..170])
    result = if block34[0] == 0 || result == 0 then 0 else 1 fi
    block35 = validate_block_header(reference_target, block34[1..3], intermediate_blocks[170..175])
    result = if block35[0] == 0 || result == 0 then 0 else 1 fi
    block36 = validate_block_header(reference_target, block35[1..3], intermediate_blocks[175..180])
    result = if block36[0] == 0 || result == 0 then 0 else 1 fi
    block37 = validate_block_header(reference_target, block36[1..3], intermediate_blocks[180..185])
    result = if block37[0] == 0 || result == 0 then 0 else 1 fi
    block38 = validate_block_header(reference_target, block37[1..3], intermediate_blocks[185..190])
    result = if block38[0] == 0 || result == 0 then 0 else 1 fi
    block39 = validate_block_header(reference_target, block38[1..3], intermediate_blocks[190..195])
    result = if block39[0] == 0 || result == 0 then 0 else 1 fi
    block40 = validate_block_header(reference_target, block39[1..3], intermediate_blocks[195..200])
    result = if block40[0] == 0 || result == 0 then 0 else 1 fi
    block41 = validate_block_header(reference_target, block40[1..3], intermediate_blocks[200..205])
    result = if block41[0] == 0 || result == 0 then 0 else 1 fi
    block42 = validate_block_header(reference_target, block41[1..3], intermediate_blocks[205..210])
    result = if block42[0] == 0 || result == 0 then 0 else 1 fi
    block43 = validate_block_header(reference_target, block42[1..3], intermediate_blocks[210..215])
    result = if block43[0] == 0 || result == 0 then 0 else 1 fi
    block44 = validate_block_header(reference_target, block43[1..3], intermediate_blocks[215..220])
    result = if block44[0] == 0 || result == 0 then 0 else 1 fi
    block45 = validate_block_header(reference_target, block44[1..3], intermediate_blocks[220..225])
    result = if block45[0] == 0 || result == 0 then 0 else 1 fi
    block46 = validate_block_header(reference_target, block45[1..3], intermediate_blocks[225..230])
    result = if block46[0] == 0 || result == 0 then 0 else 1 fi
    block47 = validate_block_header(reference_target, block46[1..3], intermediate_blocks[230..235])
    result = if block47[0] == 0 || result == 0 then 0 else 1 fi
    block48 = validate_block_header(reference_target, block47[1..3], intermediate_blocks[235..240])
    result = if block48[0] == 0 || result == 0 then 0 else 1 fi
    block49 = validate_block_header(reference_target, block48[1..3], intermediate_blocks[240..245])
    result = if block49[0] == 0 || result == 0 then 0 else 1 fi
    block50 = validate_block_header(reference_target, block49[1..3], intermediate_blocks[245..250])
    result = if block50[0] == 0 || result == 0 then 0 else 1 fi
    block51 = validate_block_header(reference_target, block50[1..3], intermediate_blocks[250..255])
    result = if block51[0] == 0 || result == 0 then 0 else 1 fi
    block52 = validate_block_header(reference_target, block51[1..3], intermediate_blocks[255..260])
    result = if block52[0] == 0 || result == 0 then 0 else 1 fi
    block53 = validate_block_header(reference_target, block52[1..3], intermediate_blocks[260..265])
    result = if block53[0] == 0 || result == 0 then 0 else 1 fi
    block54 = validate_block_header(reference_target, block53[1..3], intermediate_blocks[265..270])
    result = if block54[0] == 0 || result == 0 then 0 else 1 fi
    block55 = validate_block_header(reference_target, block54[1..3], intermediate_blocks[270..275])
    result = if block55[0] == 0 || result == 0 then 0 else 1 fi
    block56 = validate_block_header(reference_target, block55[1..3], intermediate_blocks[275..280])
    result = if block56[0] == 0 || result == 0 then 0 else 1 fi
    block57 = validate_block_header(reference_target, block56[1..3], intermediate_blocks[280..285])
    result = if block57[0] == 0 || result == 0 then 0 else 1 fi
    block58 = validate_block_header(reference_target, block57[1..3], intermediate_blocks[285..290])
    result = if block58[0] == 0 || result == 0 then 0 else 1 fi
    block59 = validate_block_header(reference_target, block58[1..3], intermediate_blocks[290..295])
    result = if block59[0] == 0 || result == 0 then 0 else 1 fi
    block60 = validate_block_header(reference_target, block59[1..3], intermediate_blocks[295..300])
    result = if block60[0] == 0 || result == 0 then 0 else 1 fi
    block61 = validate_block_header(reference_target, block60[1..3], intermediate_blocks[300..305])
    result = if block61[0] == 0 || result == 0 then 0 else 1 fi
    block62 = validate_block_header(reference_target, block61[1..3], intermediate_blocks[305..310])
    result = if block62[0] == 0 || result == 0 then 0 else 1 fi
    block63 = validate_block_header(reference_target, block62[1..3], intermediate_blocks[310..315])
    result = if block63[0] == 0 || result == 0 then 0 else 1 fi
    block64 = validate_block_header(reference_target, block63[1..3], intermediate_blocks[315..320])
    result = if block64[0] == 0 || result == 0 then 0 else 1 fi
    block65 = validate_block_header(reference_target, block64[1..3], intermediate_blocks[320..325])
    result = if block65[0] == 0 || result == 0 then 0 else 1 fi
    block66 = validate_block_header(reference_target, block65[1..3], intermediate_blocks[325..330])
    result = if block66[0] == 0 || result == 0 then 0 else 1 fi
    block67 = validate_block_header(reference_target, block66[1..3], intermediate_blocks[330..335])
    result = if block67[0] == 0 || result == 0 then 0 else 1 fi
    block68 = validate_block_header(reference_target, block67[1..3], intermediate_blocks[335..340])
    result = if block68[0] == 0 || result == 0 then 0 else 1 fi
    block69 = validate_block_header(reference_target, block68[1..3], intermediate_blocks[340..345])
    result = if block69[0] == 0 || result == 0 then 0 else 1 fi
    block70 = validate_block_header(reference_target, block69[1..3], intermediate_blocks[345..350])
    result = if block70[0] == 0 || result == 0 then 0 else 1 fi
    block71 = validate_block_header(reference_target, block70[1..3], intermediate_blocks[350..355])
    result = if block71[0] == 0 || result == 0 then 0 else 1 fi
    block72 = validate_block_header(reference_target, block71[1..3], intermediate_blocks[355..360])
    result = if block72[0] == 0 || result == 0 then 0 else 1 fi
    block73 = validate_block_header(reference_target, block72[1..3], intermediate_blocks[360..365])
    result = if block73[0] == 0 || result == 0 then 0 else 1 fi
    block74 = validate_block_header(reference_target, block73[1..3], intermediate_blocks[365..370])
    result = if block74[0] == 0 || result == 0 then 0 else 1 fi
    block75 = validate_block_header(reference_target, block74[1..3], intermediate_blocks[370..375])
    result = if block75[0] == 0 || result == 0 then 0 else 1 fi
    block76 = validate_block_header(reference_target, block75[1..3], intermediate_blocks[375..380])
    result = if block76[0] == 0 || result == 0 then 0 else 1 fi
    block77 = validate_block_header(reference_target, block76[1..3], intermediate_blocks[380..385])
    result = if block77[0] == 0 || result == 0 then 0 else 1 fi
    block78 = validate_block_header(reference_target, block77[1..3], intermediate_blocks[385..390])
    result = if block78[0] == 0 || result == 0 then 0 else 1 fi
    block79 = validate_block_header(reference_target, block78[1..3], intermediate_blocks[390..395])
    result = if block79[0] == 0 || result == 0 then 0 else 1 fi
    block80 = validate_block_header(reference_target, block79[1..3], intermediate_blocks[395..400])
    result = if block80[0] == 0 || result == 0 then 0 else 1 fi
    block81 = validate_block_header(reference_target, block80[1..3], intermediate_blocks[400..405])
    result = if block81[0] == 0 || result == 0 then 0 else 1 fi
    block82 = validate_block_header(reference_target, block81[1..3], intermediate_blocks[405..410])
    result = if block82[0] == 0 || result == 0 then 0 else 1 fi
    block83 = validate_block_header(reference_target, block82[1..3], intermediate_blocks[410..415])
    result = if block83[0] == 0 || result == 0 then 0 else 1 fi
    block84 = validate_block_header(reference_target, block83[1..3], intermediate_blocks[415..420])
    result = if block84[0] == 0 || result == 0 then 0 else 1 fi
    block85 = validate_block_header(reference_target, block84[1..3], intermediate_blocks[420..425])
    result = if block85[0] == 0 || result == 0 then 0 else 1 fi
    block86 = validate_block_header(reference_target, block85[1..3], intermediate_blocks[425..430])
    result = if block86[0] == 0 || result == 0 then 0 else 1 fi
    block87 = validate_block_header(reference_target, block86[1..3], intermediate_blocks[430..435])
    result = if block87[0] == 0 || result == 0 then 0 else 1 fi
    block88 = validate_block_header(reference_target, block87[1..3], intermediate_blocks[435..440])
    result = if block88[0] == 0 || result == 0 then 0 else 1 fi
    block89 = validate_block_header(reference_target, block88[1..3], intermediate_blocks[440..445])
    result = if block89[0] == 0 || result == 0 then 0 else 1 fi
    block90 = validate_block_header(reference_target, block89[1..3], intermediate_blocks[445..450])
    result = if block90[0] == 0 || result == 0 then 0 else 1 fi
    block91 = validate_block_header(reference_target, block90[1..3], intermediate_blocks[450..455])
    result = if block91[0] == 0 || result == 0 then 0 else 1 fi
    block92 = validate_block_header(reference_target, block91[1..3], intermediate_blocks[455..460])
    result = if block92[0] == 0 || result == 0 then 0 else 1 fi
    block93 = validate_block_header(reference_target, block92[1..3], intermediate_blocks[460..465])
    result = if block93[0] == 0 || result == 0 then 0 else 1 fi
    block94 = validate_block_header(reference_target, block93[1..3], intermediate_blocks[465..470])
    result = if block94[0] == 0 || result == 0 then 0 else 1 fi
    block95 = validate_block_header(reference_target, block94[1..3], intermediate_blocks[470..475])
    result = if block95[0] == 0 || result == 0 then 0 else 1 fi
    block96 = validate_block_header(reference_target, block95[1..3], intermediate_blocks[475..480])
    result = if block96[0] == 0 || result == 0 then 0 else 1 fi
    block97 = validate_block_header(reference_target, block96[1..3], intermediate_blocks[480..485])
    result = if block97[0] == 0 || result == 0 then 0 else 1 fi
    block98 = validate_block_header(reference_target, block97[1..3], intermediate_blocks[485..490])
    result = if block98[0] == 0 || result == 0 then 0 else 1 fi
    block99 = validate_block_header(reference_target, block98[1..3], intermediate_blocks[490..495])
    result = if block99[0] == 0 || result == 0 then 0 else 1 fi
    block100 = validate_block_header(reference_target, block99[1..3], intermediate_blocks[495..500])
    result = if block100[0] == 0 || result == 0 then 0 else 1 fi
    block101 = validate_block_header(reference_target, block100[1..3], intermediate_blocks[500..505])
    result = if block101[0] == 0 || result == 0 then 0 else 1 fi
    block102 = validate_block_header(reference_target, block101[1..3], intermediate_blocks[505..510])
    result = if block102[0] == 0 || result == 0 then 0 else 1 fi
    block103 = validate_block_header(reference_target, block102[1..3], intermediate_blocks[510..515])
    result = if block103[0] == 0 || result == 0 then 0 else 1 fi
    block104 = validate_block_header(reference_target, block103[1..3], intermediate_blocks[515..520])
    result = if block104[0] == 0 || result == 0 then 0 else 1 fi
    block105 = validate_block_header(reference_target, block104[1..3], intermediate_blocks[520..525])
    result = if block105[0] == 0 || result == 0 then 0 else 1 fi
    block106 = validate_block_header(reference_target, block105[1..3], intermediate_blocks[525..530])
    result = if block106[0] == 0 || result == 0 then 0 else 1 fi
    block107 = validate_block_header(reference_target, block106[1..3], intermediate_blocks[530..535])
    result = if block107[0] == 0 || result == 0 then 0 else 1 fi
    block108 = validate_block_header(reference_target, block107[1..3], intermediate_blocks[535..540])
    result = if block108[0] == 0 || result == 0 then 0 else 1 fi
    block109 = validate_block_header(reference_target, block108[1..3], intermediate_blocks[540..545])
    result = if block109[0] == 0 || result == 0 then 0 else 1 fi
    block110 = validate_block_header(reference_target, block109[1..3], intermediate_blocks[545..550])
    result = if block110[0] == 0 || result == 0 then 0 else 1 fi
    block111 = validate_block_header(reference_target, block110[1..3], intermediate_blocks[550..555])
    result = if block111[0] == 0 || result == 0 then 0 else 1 fi
    block112 = validate_block_header(reference_target, block111[1..3], intermediate_blocks[555..560])
    result = if block112[0] == 0 || result == 0 then 0 else 1 fi
    block113 = validate_block_header(reference_target, block112[1..3], intermediate_blocks[560..565])
    result = if block113[0] == 0 || result == 0 then 0 else 1 fi
    block114 = validate_block_header(reference_target, block113[1..3], intermediate_blocks[565..570])
    result = if block114[0] == 0 || result == 0 then 0 else 1 fi
    block115 = validate_block_header(reference_target, block114[1..3], intermediate_blocks[570..575])
    result = if block115[0] == 0 || result == 0 then 0 else 1 fi
    block116 = validate_block_header(reference_target, block115[1..3], intermediate_blocks[575..580])
    result = if block116[0] == 0 || result == 0 then 0 else 1 fi
    block117 = validate_block_header(reference_target, block116[1..3], intermediate_blocks[580..585])
    result = if block117[0] == 0 || result == 0 then 0 else 1 fi
    block118 = validate_block_header(reference_target, block117[1..3], intermediate_blocks[585..590])
    result = if block118[0] == 0 || result == 0 then 0 else 1 fi
    block119 = validate_block_header(reference_target, block118[1..3], intermediate_blocks[590..595])
    result = if block119[0] == 0 || result == 0 then 0 else 1 fi
    block120 = validate_block_header(reference_target, block119[1..3], intermediate_blocks[595..600])
    result = if block120[0] == 0 || result == 0 then 0 else 1 fi
    block121 = validate_block_header(reference_target, block120[1..3], intermediate_blocks[600..605])
    result = if block121[0] == 0 || result == 0 then 0 else 1 fi
    block122 = validate_block_header(reference_target, block121[1..3], intermediate_blocks[605..610])
    result = if block122[0] == 0 || result == 0 then 0 else 1 fi
    block123 = validate_block_header(reference_target, block122[1..3], intermediate_blocks[610..615])
    result = if block123[0] == 0 || result == 0 then 0 else 1 fi
    block124 = validate_block_header(reference_target, block123[1..3], intermediate_blocks[615..620])
    result = if block124[0] == 0 || result == 0 then 0 else 1 fi
    block125 = validate_block_header(reference_target, block124[1..3], intermediate_blocks[620..625])
    result = if block125[0] == 0 || result == 0 then 0 else 1 fi
    block126 = validate_block_header(reference_target, block125[1..3], intermediate_blocks[625..630])
    result = if block126[0] == 0 || result == 0 then 0 else 1 fi
    block127 = validate_block_header(reference_target, block126[1..3], intermediate_blocks[630..635])
    result = if block127[0] == 0 || result == 0 then 0 else 1 fi
    block128 = validate_block_header(reference_target, block127[1..3], intermediate_blocks[635..640])
    result = if block128[0] == 0 || result == 0 then 0 else 1 fi
    block129 = validate_block_header(reference_target, block128[1..3], intermediate_blocks[640..645])
    result = if block129[0] == 0 || result == 0 then 0 else 1 fi
    block130 = validate_block_header(reference_target, block129[1..3], intermediate_blocks[645..650])
    result = if block130[0] == 0 || result == 0 then 0 else 1 fi
    block131 = validate_block_header(reference_target, block130[1..3], intermediate_blocks[650..655])
    result = if block131[0] == 0 || result == 0 then 0 else 1 fi
    block132 = validate_block_header(reference_target, block131[1..3], intermediate_blocks[655..660])
    result = if block132[0] == 0 || result == 0 then 0 else 1 fi
    block133 = validate_block_header(reference_target, block132[1..3], intermediate_blocks[660..665])
    result = if block133[0] == 0 || result == 0 then 0 else 1 fi
    block134 = validate_block_header(reference_target, block133[1..3], intermediate_blocks[665..670])
    result = if block134[0] == 0 || result == 0 then 0 else 1 fi
    block135 = validate_block_header(reference_target, block134[1..3], intermediate_blocks[670..675])
    result = if block135[0] == 0 || result == 0 then 0 else 1 fi
    block136 = validate_block_header(reference_target, block135[1..3], intermediate_blocks[675..680])
    result = if block136[0] == 0 || result == 0 then 0 else 1 fi
    block137 = validate_block_header(reference_target, block136[1..3], intermediate_blocks[680..685])
    result = if block137[0] == 0 || result == 0 then 0 else 1 fi
    block138 = validate_block_header(reference_target, block137[1..3], intermediate_blocks[685..690])
    result = if block138[0] == 0 || result == 0 then 0 else 1 fi
    block139 = validate_block_header(reference_target, block138[1..3], intermediate_blocks[690..695])
    result = if block139[0] == 0 || result == 0 then 0 else 1 fi
    block140 = validate_block_header(reference_target, block139[1..3], intermediate_blocks[695..700])
    result = if block140[0] == 0 || result == 0 then 0 else 1 fi
    block141 = validate_block_header(reference_target, block140[1..3], intermediate_blocks[700..705])
    result = if block141[0] == 0 || result == 0 then 0 else 1 fi
    block142 = validate_block_header(reference_target, block141[1..3], intermediate_blocks[705..710])
    result = if block142[0] == 0 || result == 0 then 0 else 1 fi
    block143 = validate_block_header(reference_target, block142[1..3], intermediate_blocks[710..715])
    result = if block143[0] == 0 || result == 0 then 0 else 1 fi
    block144 = validate_block_header(reference_target, block143[1..3], intermediate_blocks[715..720])
    result = if block144[0] == 0 || result == 0 then 0 else 1 fi
    block145 = validate_block_header(reference_target, block144[1..3], intermediate_blocks[720..725])
    result = if block145[0] == 0 || result == 0 then 0 else 1 fi
    block146 = validate_block_header(reference_target, block145[1..3], intermediate_blocks[725..730])
    result = if block146[0] == 0 || result == 0 then 0 else 1 fi
    block147 = validate_block_header(reference_target, block146[1..3], intermediate_blocks[730..735])
    result = if block147[0] == 0 || result == 0 then 0 else 1 fi
    block148 = validate_block_header(reference_target, block147[1..3], intermediate_blocks[735..740])
    result = if block148[0] == 0 || result == 0 then 0 else 1 fi
    block149 = validate_block_header(reference_target, block148[1..3], intermediate_blocks[740..745])
    result = if block149[0] == 0 || result == 0 then 0 else 1 fi
    block150 = validate_block_header(reference_target, block149[1..3], intermediate_blocks[745..750])
    result = if block150[0] == 0 || result == 0 then 0 else 1 fi
    block151 = validate_block_header(reference_target, block150[1..3], intermediate_blocks[750..755])
    result = if block151[0] == 0 || result == 0 then 0 else 1 fi
    block152 = validate_block_header(reference_target, block151[1..3], intermediate_blocks[755..760])
    result = if block152[0] == 0 || result == 0 then 0 else 1 fi
    block153 = validate_block_header(reference_target, block152[1..3], intermediate_blocks[760..765])
    result = if block153[0] == 0 || result == 0 then 0 else 1 fi
    block154 = validate_block_header(reference_target, block153[1..3], intermediate_blocks[765..770])
    result = if block154[0] == 0 || result == 0 then 0 else 1 fi
    block155 = validate_block_header(reference_target, block154[1..3], intermediate_blocks[770..775])
    result = if block155[0] == 0 || result == 0 then 0 else 1 fi
    block156 = validate_block_header(reference_target, block155[1..3], intermediate_blocks[775..780])
    result = if block156[0] == 0 || result == 0 then 0 else 1 fi
    block157 = validate_block_header(reference_target, block156[1..3], intermediate_blocks[780..785])
    result = if block157[0] == 0 || result == 0 then 0 else 1 fi
    block158 = validate_block_header(reference_target, block157[1..3], intermediate_blocks[785..790])
    result = if block158[0] == 0 || result == 0 then 0 else 1 fi
    block159 = validate_block_header(reference_target, block158[1..3], intermediate_blocks[790..795])
    result = if block159[0] == 0 || result == 0 then 0 else 1 fi
    block160 = validate_block_header(reference_target, block159[1..3], intermediate_blocks[795..800])
    result = if block160[0] == 0 || result == 0 then 0 else 1 fi
    block161 = validate_block_header(reference_target, block160[1..3], intermediate_blocks[800..805])
    result = if block161[0] == 0 || result == 0 then 0 else 1 fi
    block162 = validate_block_header(reference_target, block161[1..3], intermediate_blocks[805..810])
    result = if block162[0] == 0 || result == 0 then 0 else 1 fi
    block163 = validate_block_header(reference_target, block162[1..3], intermediate_blocks[810..815])
    result = if block163[0] == 0 || result == 0 then 0 else 1 fi
    block164 = validate_block_header(reference_target, block163[1..3], intermediate_blocks[815..820])
    result = if block164[0] == 0 || result == 0 then 0 else 1 fi
    block165 = validate_block_header(reference_target, block164[1..3], intermediate_blocks[820..825])
    result = if block165[0] == 0 || result == 0 then 0 else 1 fi
    block166 = validate_block_header(reference_target, block165[1..3], intermediate_blocks[825..830])
    result = if block166[0] == 0 || result == 0 then 0 else 1 fi
    block167 = validate_block_header(reference_target, block166[1..3], intermediate_blocks[830..835])
    result = if block167[0] == 0 || result == 0 then 0 else 1 fi
    block168 = validate_block_header(reference_target, block167[1..3], intermediate_blocks[835..840])
    result = if block168[0] == 0 || result == 0 then 0 else 1 fi
    block169 = validate_block_header(reference_target, block168[1..3], intermediate_blocks[840..845])
    result = if block169[0] == 0 || result == 0 then 0 else 1 fi
    block170 = validate_block_header(reference_target, block169[1..3], intermediate_blocks[845..850])
    result = if block170[0] == 0 || result == 0 then 0 else 1 fi
    block171 = validate_block_header(reference_target, block170[1..3], intermediate_blocks[850..855])
    result = if block171[0] == 0 || result == 0 then 0 else 1 fi
    block172 = validate_block_header(reference_target, block171[1..3], intermediate_blocks[855..860])
    result = if block172[0] == 0 || result == 0 then 0 else 1 fi
    block173 = validate_block_header(reference_target, block172[1..3], intermediate_blocks[860..865])
    result = if block173[0] == 0 || result == 0 then 0 else 1 fi
    block174 = validate_block_header(reference_target, block173[1..3], intermediate_blocks[865..870])
    result = if block174[0] == 0 || result == 0 then 0 else 1 fi
    block175 = validate_block_header(reference_target, block174[1..3], intermediate_blocks[870..875])
    result = if block175[0] == 0 || result == 0 then 0 else 1 fi
    block176 = validate_block_header(reference_target, block175[1..3], intermediate_blocks[875..880])
    result = if block176[0] == 0 || result == 0 then 0 else 1 fi
    block177 = validate_block_header(reference_target, block176[1..3], intermediate_blocks[880..885])
    result = if block177[0] == 0 || result == 0 then 0 else 1 fi
    block178 = validate_block_header(reference_target, block177[1..3], intermediate_blocks[885..890])
    result = if block178[0] == 0 || result == 0 then 0 else 1 fi
    block179 = validate_block_header(reference_target, block178[1..3], intermediate_blocks[890..895])
    result = if block179[0] == 0 || result == 0 then 0 else 1 fi
    block180 = validate_block_header(reference_target, block179[1..3], intermediate_blocks[895..900])
    result = if block180[0] == 0 || result == 0 then 0 else 1 fi
    block181 = validate_block_header(reference_target, block180[1..3], intermediate_blocks[900..905])
    result = if block181[0] == 0 || result == 0 then 0 else 1 fi
    block182 = validate_block_header(reference_target, block181[1..3], intermediate_blocks[905..910])
    result = if block182[0] == 0 || result == 0 then 0 else 1 fi
    block183 = validate_block_header(reference_target, block182[1..3], intermediate_blocks[910..915])
    result = if block183[0] == 0 || result == 0 then 0 else 1 fi
    block184 = validate_block_header(reference_target, block183[1..3], intermediate_blocks[915..920])
    result = if block184[0] == 0 || result == 0 then 0 else 1 fi
    block185 = validate_block_header(reference_target, block184[1..3], intermediate_blocks[920..925])
    result = if block185[0] == 0 || result == 0 then 0 else 1 fi
    block186 = validate_block_header(reference_target, block185[1..3], intermediate_blocks[925..930])
    result = if block186[0] == 0 || result == 0 then 0 else 1 fi
    block187 = validate_block_header(reference_target, block186[1..3], intermediate_blocks[930..935])
    result = if block187[0] == 0 || result == 0 then 0 else 1 fi
    block188 = validate_block_header(reference_target, block187[1..3], intermediate_blocks[935..940])
    result = if block188[0] == 0 || result == 0 then 0 else 1 fi
    block189 = validate_block_header(reference_target, block188[1..3], intermediate_blocks[940..945])
    result = if block189[0] == 0 || result == 0 then 0 else 1 fi
    block190 = validate_block_header(reference_target, block189[1..3], intermediate_blocks[945..950])
    result = if block190[0] == 0 || result == 0 then 0 else 1 fi
    block191 = validate_block_header(reference_target, block190[1..3], intermediate_blocks[950..955])
    result = if block191[0] == 0 || result == 0 then 0 else 1 fi
    block192 = validate_block_header(reference_target, block191[1..3], intermediate_blocks[955..960])
    result = if block192[0] == 0 || result == 0 then 0 else 1 fi
    block193 = validate_block_header(reference_target, block192[1..3], intermediate_blocks[960..965])
    result = if block193[0] == 0 || result == 0 then 0 else 1 fi
    block194 = validate_block_header(reference_target, block193[1..3], intermediate_blocks[965..970])
    result = if block194[0] == 0 || result == 0 then 0 else 1 fi
    block195 = validate_block_header(reference_target, block194[1..3], intermediate_blocks[970..975])
    result = if block195[0] == 0 || result == 0 then 0 else 1 fi
    block196 = validate_block_header(reference_target, block195[1..3], intermediate_blocks[975..980])
    result = if block196[0] == 0 || result == 0 then 0 else 1 fi
    block197 = validate_block_header(reference_target, block196[1..3], intermediate_blocks[980..985])
    result = if block197[0] == 0 || result == 0 then 0 else 1 fi
    block198 = validate_block_header(reference_target, block197[1..3], intermediate_blocks[985..990])
    result = if block198[0] == 0 || result == 0 then 0 else 1 fi
    block199 = validate_block_header(reference_target, block198[1..3], intermediate_blocks[990..995])
    result = if block199[0] == 0 || result == 0 then 0 else 1 fi
    block200 = validate_block_header(reference_target, block199[1..3], intermediate_blocks[995..1000])
    result = if block200[0] == 0 || result == 0 then 0 else 1 fi
    block201 = validate_block_header(reference_target, block200[1..3], intermediate_blocks[1000..1005])
    result = if block201[0] == 0 || result == 0 then 0 else 1 fi
    block202 = validate_block_header(reference_target, block201[1..3], intermediate_blocks[1005..1010])
    result = if block202[0] == 0 || result == 0 then 0 else 1 fi
    block203 = validate_block_header(reference_target, block202[1..3], intermediate_blocks[1010..1015])
    result = if block203[0] == 0 || result == 0 then 0 else 1 fi
    block204 = validate_block_header(reference_target, block203[1..3], intermediate_blocks[1015..1020])
    result = if block204[0] == 0 || result == 0 then 0 else 1 fi
    block205 = validate_block_header(reference_target, block204[1..3], intermediate_blocks[1020..1025])
    result = if block205[0] == 0 || result == 0 then 0 else 1 fi
    block206 = validate_block_header(reference_target, block205[1..3], intermediate_blocks[1025..1030])
    result = if block206[0] == 0 || result == 0 then 0 else 1 fi
    block207 = validate_block_header(reference_target, block206[1..3], intermediate_blocks[1030..1035])
    result = if block207[0] == 0 || result == 0 then 0 else 1 fi
    block208 = validate_block_header(reference_target, block207[1..3], intermediate_blocks[1035..1040])
    result = if block208[0] == 0 || result == 0 then 0 else 1 fi
    block209 = validate_block_header(reference_target, block208[1..3], intermediate_blocks[1040..1045])
    result = if block209[0] == 0 || result == 0 then 0 else 1 fi
    block210 = validate_block_header(reference_target, block209[1..3], intermediate_blocks[1045..1050])
    result = if block210[0] == 0 || result == 0 then 0 else 1 fi
    block211 = validate_block_header(reference_target, block210[1..3], intermediate_blocks[1050..1055])
    result = if block211[0] == 0 || result == 0 then 0 else 1 fi
    block212 = validate_block_header(reference_target, block211[1..3], intermediate_blocks[1055..1060])
    result = if block212[0] == 0 || result == 0 then 0 else 1 fi
    block213 = validate_block_header(reference_target, block212[1..3], intermediate_blocks[1060..1065])
    result = if block213[0] == 0 || result == 0 then 0 else 1 fi
    block214 = validate_block_header(reference_target, block213[1..3], intermediate_blocks[1065..1070])
    result = if block214[0] == 0 || result == 0 then 0 else 1 fi
    block215 = validate_block_header(reference_target, block214[1..3], intermediate_blocks[1070..1075])
    result = if block215[0] == 0 || result == 0 then 0 else 1 fi
    block216 = validate_block_header(reference_target, block215[1..3], intermediate_blocks[1075..1080])
    result = if block216[0] == 0 || result == 0 then 0 else 1 fi
    block217 = validate_block_header(reference_target, block216[1..3], intermediate_blocks[1080..1085])
    result = if block217[0] == 0 || result == 0 then 0 else 1 fi
    block218 = validate_block_header(reference_target, block217[1..3], intermediate_blocks[1085..1090])
    result = if block218[0] == 0 || result == 0 then 0 else 1 fi
    block219 = validate_block_header(reference_target, block218[1..3], intermediate_blocks[1090..1095])
    result = if block219[0] == 0 || result == 0 then 0 else 1 fi
    block220 = validate_block_header(reference_target, block219[1..3], intermediate_blocks[1095..1100])
    result = if block220[0] == 0 || result == 0 then 0 else 1 fi
    block221 = validate_block_header(reference_target, block220[1..3], intermediate_blocks[1100..1105])
    result = if block221[0] == 0 || result == 0 then 0 else 1 fi
    block222 = validate_block_header(reference_target, block221[1..3], intermediate_blocks[1105..1110])
    result = if block222[0] == 0 || result == 0 then 0 else 1 fi
    block223 = validate_block_header(reference_target, block222[1..3], intermediate_blocks[1110..1115])
    result = if block223[0] == 0 || result == 0 then 0 else 1 fi
    block224 = validate_block_header(reference_target, block223[1..3], intermediate_blocks[1115..1120])
    result = if block224[0] == 0 || result == 0 then 0 else 1 fi
    block225 = validate_block_header(reference_target, block224[1..3], intermediate_blocks[1120..1125])
    result = if block225[0] == 0 || result == 0 then 0 else 1 fi
    block226 = validate_block_header(reference_target, block225[1..3], intermediate_blocks[1125..1130])
    result = if block226[0] == 0 || result == 0 then 0 else 1 fi
    block227 = validate_block_header(reference_target, block226[1..3], intermediate_blocks[1130..1135])
    result = if block227[0] == 0 || result == 0 then 0 else 1 fi
    block228 = validate_block_header(reference_target, block227[1..3], intermediate_blocks[1135..1140])
    result = if block228[0] == 0 || result == 0 then 0 else 1 fi
    block229 = validate_block_header(reference_target, block228[1..3], intermediate_blocks[1140..1145])
    result = if block229[0] == 0 || result == 0 then 0 else 1 fi
    block230 = validate_block_header(reference_target, block229[1..3], intermediate_blocks[1145..1150])
    result = if block230[0] == 0 || result == 0 then 0 else 1 fi
    block231 = validate_block_header(reference_target, block230[1..3], intermediate_blocks[1150..1155])
    result = if block231[0] == 0 || result == 0 then 0 else 1 fi
    block232 = validate_block_header(reference_target, block231[1..3], intermediate_blocks[1155..1160])
    result = if block232[0] == 0 || result == 0 then 0 else 1 fi
    block233 = validate_block_header(reference_target, block232[1..3], intermediate_blocks[1160..1165])
    result = if block233[0] == 0 || result == 0 then 0 else 1 fi
    block234 = validate_block_header(reference_target, block233[1..3], intermediate_blocks[1165..1170])
    result = if block234[0] == 0 || result == 0 then 0 else 1 fi
    block235 = validate_block_header(reference_target, block234[1..3], intermediate_blocks[1170..1175])
    result = if block235[0] == 0 || result == 0 then 0 else 1 fi
    block236 = validate_block_header(reference_target, block235[1..3], intermediate_blocks[1175..1180])
    result = if block236[0] == 0 || result == 0 then 0 else 1 fi
    block237 = validate_block_header(reference_target, block236[1..3], intermediate_blocks[1180..1185])
    result = if block237[0] == 0 || result == 0 then 0 else 1 fi
    block238 = validate_block_header(reference_target, block237[1..3], intermediate_blocks[1185..1190])
    result = if block238[0] == 0 || result == 0 then 0 else 1 fi
    block239 = validate_block_header(reference_target, block238[1..3], intermediate_blocks[1190..1195])
    result = if block239[0] == 0 || result == 0 then 0 else 1 fi
    block240 = validate_block_header(reference_target, block239[1..3], intermediate_blocks[1195..1200])
    result = if block240[0] == 0 || result == 0 then 0 else 1 fi
    block241 = validate_block_header(reference_target, block240[1..3], intermediate_blocks[1200..1205])
    result = if block241[0] == 0 || result == 0 then 0 else 1 fi
    block242 = validate_block_header(reference_target, block241[1..3], intermediate_blocks[1205..1210])
    result = if block242[0] == 0 || result == 0 then 0 else 1 fi
    block243 = validate_block_header(reference_target, block242[1..3], intermediate_blocks[1210..1215])
    result = if block243[0] == 0 || result == 0 then 0 else 1 fi
    block244 = validate_block_header(reference_target, block243[1..3], intermediate_blocks[1215..1220])
    result = if block244[0] == 0 || result == 0 then 0 else 1 fi
    block245 = validate_block_header(reference_target, block244[1..3], intermediate_blocks[1220..1225])
    result = if block245[0] == 0 || result == 0 then 0 else 1 fi
    block246 = validate_block_header(reference_target, block245[1..3], intermediate_blocks[1225..1230])
    result = if block246[0] == 0 || result == 0 then 0 else 1 fi
    block247 = validate_block_header(reference_target, block246[1..3], intermediate_blocks[1230..1235])
    result = if block247[0] == 0 || result == 0 then 0 else 1 fi
    block248 = validate_block_header(reference_target, block247[1..3], intermediate_blocks[1235..1240])
    result = if block248[0] == 0 || result == 0 then 0 else 1 fi
    block249 = validate_block_header(reference_target, block248[1..3], intermediate_blocks[1240..1245])
    result = if block249[0] == 0 || result == 0 then 0 else 1 fi
    block250 = validate_block_header(reference_target, block249[1..3], intermediate_blocks[1245..1250])
    result = if block250[0] == 0 || result == 0 then 0 else 1 fi
    block251 = validate_block_header(reference_target, block250[1..3], intermediate_blocks[1250..1255])
    result = if block251[0] == 0 || result == 0 then 0 else 1 fi
    block252 = validate_block_header(reference_target, block251[1..3], intermediate_blocks[1255..1260])
    result = if block252[0] == 0 || result == 0 then 0 else 1 fi
    block253 = validate_block_header(reference_target, block252[1..3], intermediate_blocks[1260..1265])
    result = if block253[0] == 0 || result == 0 then 0 else 1 fi
    block254 = validate_block_header(reference_target, block253[1..3], intermediate_blocks[1265..1270])
    result = if block254[0] == 0 || result == 0 then 0 else 1 fi
    block255 = validate_block_header(reference_target, block254[1..3], intermediate_blocks[1270..1275])
    result = if block255[0] == 0 || result == 0 then 0 else 1 fi
    block256 = validate_block_header(reference_target, block255[1..3], intermediate_blocks[1275..1280])
    result = if block256[0] == 0 || result == 0 then 0 else 1 fi
    block257 = validate_block_header(reference_target, block256[1..3], intermediate_blocks[1280..1285])
    result = if block257[0] == 0 || result == 0 then 0 else 1 fi
    block258 = validate_block_header(reference_target, block257[1..3], intermediate_blocks[1285..1290])
    result = if block258[0] == 0 || result == 0 then 0 else 1 fi
    block259 = validate_block_header(reference_target, block258[1..3], intermediate_blocks[1290..1295])
    result = if block259[0] == 0 || result == 0 then 0 else 1 fi
    block260 = validate_block_header(reference_target, block259[1..3], intermediate_blocks[1295..1300])
    result = if block260[0] == 0 || result == 0 then 0 else 1 fi
    block261 = validate_block_header(reference_target, block260[1..3], intermediate_blocks[1300..1305])
    result = if block261[0] == 0 || result == 0 then 0 else 1 fi
    block262 = validate_block_header(reference_target, block261[1..3], intermediate_blocks[1305..1310])
    result = if block262[0] == 0 || result == 0 then 0 else 1 fi
    block263 = validate_block_header(reference_target, block262[1..3], intermediate_blocks[1310..1315])
    result = if block263[0] == 0 || result == 0 then 0 else 1 fi
    block264 = validate_block_header(reference_target, block263[1..3], intermediate_blocks[1315..1320])
    result = if block264[0] == 0 || result == 0 then 0 else 1 fi
    block265 = validate_block_header(reference_target, block264[1..3], intermediate_blocks[1320..1325])
    result = if block265[0] == 0 || result == 0 then 0 else 1 fi
    block266 = validate_block_header(reference_target, block265[1..3], intermediate_blocks[1325..1330])
    result = if block266[0] == 0 || result == 0 then 0 else 1 fi
    block267 = validate_block_header(reference_target, block266[1..3], intermediate_blocks[1330..1335])
    result = if block267[0] == 0 || result == 0 then 0 else 1 fi
    block268 = validate_block_header(reference_target, block267[1..3], intermediate_blocks[1335..1340])
    result = if block268[0] == 0 || result == 0 then 0 else 1 fi
    block269 = validate_block_header(reference_target, block268[1..3], intermediate_blocks[1340..1345])
    result = if block269[0] == 0 || result == 0 then 0 else 1 fi
    block270 = validate_block_header(reference_target, block269[1..3], intermediate_blocks[1345..1350])
    result = if block270[0] == 0 || result == 0 then 0 else 1 fi
    block271 = validate_block_header(reference_target, block270[1..3], intermediate_blocks[1350..1355])
    result = if block271[0] == 0 || result == 0 then 0 else 1 fi
    block272 = validate_block_header(reference_target, block271[1..3], intermediate_blocks[1355..1360])
    result = if block272[0] == 0 || result == 0 then 0 else 1 fi
    block273 = validate_block_header(reference_target, block272[1..3], intermediate_blocks[1360..1365])
    result = if block273[0] == 0 || result == 0 then 0 else 1 fi
    block274 = validate_block_header(reference_target, block273[1..3], intermediate_blocks[1365..1370])
    result = if block274[0] == 0 || result == 0 then 0 else 1 fi
    block275 = validate_block_header(reference_target, block274[1..3], intermediate_blocks[1370..1375])
    result = if block275[0] == 0 || result == 0 then 0 else 1 fi
    block276 = validate_block_header(reference_target, block275[1..3], intermediate_blocks[1375..1380])
    result = if block276[0] == 0 || result == 0 then 0 else 1 fi
    block277 = validate_block_header(reference_target, block276[1..3], intermediate_blocks[1380..1385])
    result = if block277[0] == 0 || result == 0 then 0 else 1 fi
    block278 = validate_block_header(reference_target, block277[1..3], intermediate_blocks[1385..1390])
    result = if block278[0] == 0 || result == 0 then 0 else 1 fi
    block279 = validate_block_header(reference_target, block278[1..3], intermediate_blocks[1390..1395])
    result = if block279[0] == 0 || result == 0 then 0 else 1 fi
    block280 = validate_block_header(reference_target, block279[1..3], intermediate_blocks[1395..1400])
    result = if block280[0] == 0 || result == 0 then 0 else 1 fi
    block281 = validate_block_header(reference_target, block280[1..3], intermediate_blocks[1400..1405])
    result = if block281[0] == 0 || result == 0 then 0 else 1 fi
    block282 = validate_block_header(reference_target, block281[1..3], intermediate_blocks[1405..1410])
    result = if block282[0] == 0 || result == 0 then 0 else 1 fi
    block283 = validate_block_header(reference_target, block282[1..3], intermediate_blocks[1410..1415])
    result = if block283[0] == 0 || result == 0 then 0 else 1 fi
    block284 = validate_block_header(reference_target, block283[1..3], intermediate_blocks[1415..1420])
    result = if block284[0] == 0 || result == 0 then 0 else 1 fi
    block285 = validate_block_header(reference_target, block284[1..3], intermediate_blocks[1420..1425])
    result = if block285[0] == 0 || result == 0 then 0 else 1 fi
    block286 = validate_block_header(reference_target, block285[1..3], intermediate_blocks[1425..1430])
    result = if block286[0] == 0 || result == 0 then 0 else 1 fi
    block287 = validate_block_header(reference_target, block286[1..3], intermediate_blocks[1430..1435])
    result = if block287[0] == 0 || result == 0 then 0 else 1 fi
    block288 = validate_block_header(reference_target, block287[1..3], intermediate_blocks[1435..1440])
    result = if block288[0] == 0 || result == 0 then 0 else 1 fi
    block289 = validate_block_header(reference_target, block288[1..3], intermediate_blocks[1440..1445])
    result = if block289[0] == 0 || result == 0 then 0 else 1 fi
    block290 = validate_block_header(reference_target, block289[1..3], intermediate_blocks[1445..1450])
    result = if block290[0] == 0 || result == 0 then 0 else 1 fi
    block291 = validate_block_header(reference_target, block290[1..3], intermediate_blocks[1450..1455])
    result = if block291[0] == 0 || result == 0 then 0 else 1 fi
    block292 = validate_block_header(reference_target, block291[1..3], intermediate_blocks[1455..1460])
    result = if block292[0] == 0 || result == 0 then 0 else 1 fi
    block293 = validate_block_header(reference_target, block292[1..3], intermediate_blocks[1460..1465])
    result = if block293[0] == 0 || result == 0 then 0 else 1 fi
    block294 = validate_block_header(reference_target, block293[1..3], intermediate_blocks[1465..1470])
    result = if block294[0] == 0 || result == 0 then 0 else 1 fi
    block295 = validate_block_header(reference_target, block294[1..3], intermediate_blocks[1470..1475])
    result = if block295[0] == 0 || result == 0 then 0 else 1 fi
    block296 = validate_block_header(reference_target, block295[1..3], intermediate_blocks[1475..1480])
    result = if block296[0] == 0 || result == 0 then 0 else 1 fi
    block297 = validate_block_header(reference_target, block296[1..3], intermediate_blocks[1480..1485])
    result = if block297[0] == 0 || result == 0 then 0 else 1 fi
    block298 = validate_block_header(reference_target, block297[1..3], intermediate_blocks[1485..1490])
    result = if block298[0] == 0 || result == 0 then 0 else 1 fi
    block299 = validate_block_header(reference_target, block298[1..3], intermediate_blocks[1490..1495])
    result = if block299[0] == 0 || result == 0 then 0 else 1 fi
    block300 = validate_block_header(reference_target, block299[1..3], intermediate_blocks[1495..1500])
    result = if block300[0] == 0 || result == 0 then 0 else 1 fi
    block301 = validate_block_header(reference_target, block300[1..3], intermediate_blocks[1500..1505])
    result = if block301[0] == 0 || result == 0 then 0 else 1 fi
    block302 = validate_block_header(reference_target, block301[1..3], intermediate_blocks[1505..1510])
    result = if block302[0] == 0 || result == 0 then 0 else 1 fi
    block303 = validate_block_header(reference_target, block302[1..3], intermediate_blocks[1510..1515])
    result = if block303[0] == 0 || result == 0 then 0 else 1 fi
    block304 = validate_block_header(reference_target, block303[1..3], intermediate_blocks[1515..1520])
    result = if block304[0] == 0 || result == 0 then 0 else 1 fi
    block305 = validate_block_header(reference_target, block304[1..3], intermediate_blocks[1520..1525])
    result = if block305[0] == 0 || result == 0 then 0 else 1 fi
    block306 = validate_block_header(reference_target, block305[1..3], intermediate_blocks[1525..1530])
    result = if block306[0] == 0 || result == 0 then 0 else 1 fi
    block307 = validate_block_header(reference_target, block306[1..3], intermediate_blocks[1530..1535])
    result = if block307[0] == 0 || result == 0 then 0 else 1 fi
    block308 = validate_block_header(reference_target, block307[1..3], intermediate_blocks[1535..1540])
    result = if block308[0] == 0 || result == 0 then 0 else 1 fi
    block309 = validate_block_header(reference_target, block308[1..3], intermediate_blocks[1540..1545])
    result = if block309[0] == 0 || result == 0 then 0 else 1 fi
    block310 = validate_block_header(reference_target, block309[1..3], intermediate_blocks[1545..1550])
    result = if block310[0] == 0 || result == 0 then 0 else 1 fi
    block311 = validate_block_header(reference_target, block310[1..3], intermediate_blocks[1550..1555])
    result = if block311[0] == 0 || result == 0 then 0 else 1 fi
    block312 = validate_block_header(reference_target, block311[1..3], intermediate_blocks[1555..1560])
    result = if block312[0] == 0 || result == 0 then 0 else 1 fi
    block313 = validate_block_header(reference_target, block312[1..3], intermediate_blocks[1560..1565])
    result = if block313[0] == 0 || result == 0 then 0 else 1 fi
    block314 = validate_block_header(reference_target, block313[1..3], intermediate_blocks[1565..1570])
    result = if block314[0] == 0 || result == 0 then 0 else 1 fi
    block315 = validate_block_header(reference_target, block314[1..3], intermediate_blocks[1570..1575])
    result = if block315[0] == 0 || result == 0 then 0 else 1 fi
    block316 = validate_block_header(reference_target, block315[1..3], intermediate_blocks[1575..1580])
    result = if block316[0] == 0 || result == 0 then 0 else 1 fi
    block317 = validate_block_header(reference_target, block316[1..3], intermediate_blocks[1580..1585])
    result = if block317[0] == 0 || result == 0 then 0 else 1 fi
    block318 = validate_block_header(reference_target, block317[1..3], intermediate_blocks[1585..1590])
    result = if block318[0] == 0 || result == 0 then 0 else 1 fi
    block319 = validate_block_header(reference_target, block318[1..3], intermediate_blocks[1590..1595])
    result = if block319[0] == 0 || result == 0 then 0 else 1 fi
    block320 = validate_block_header(reference_target, block319[1..3], intermediate_blocks[1595..1600])
    result = if block320[0] == 0 || result == 0 then 0 else 1 fi
    block321 = validate_block_header(reference_target, block320[1..3], intermediate_blocks[1600..1605])
    result = if block321[0] == 0 || result == 0 then 0 else 1 fi
    block322 = validate_block_header(reference_target, block321[1..3], intermediate_blocks[1605..1610])
    result = if block322[0] == 0 || result == 0 then 0 else 1 fi
    block323 = validate_block_header(reference_target, block322[1..3], intermediate_blocks[1610..1615])
    result = if block323[0] == 0 || result == 0 then 0 else 1 fi
    block324 = validate_block_header(reference_target, block323[1..3], intermediate_blocks[1615..1620])
    result = if block324[0] == 0 || result == 0 then 0 else 1 fi
    block325 = validate_block_header(reference_target, block324[1..3], intermediate_blocks[1620..1625])
    result = if block325[0] == 0 || result == 0 then 0 else 1 fi
    block326 = validate_block_header(reference_target, block325[1..3], intermediate_blocks[1625..1630])
    result = if block326[0] == 0 || result == 0 then 0 else 1 fi
    block327 = validate_block_header(reference_target, block326[1..3], intermediate_blocks[1630..1635])
    result = if block327[0] == 0 || result == 0 then 0 else 1 fi
    block328 = validate_block_header(reference_target, block327[1..3], intermediate_blocks[1635..1640])
    result = if block328[0] == 0 || result == 0 then 0 else 1 fi
    block329 = validate_block_header(reference_target, block328[1..3], intermediate_blocks[1640..1645])
    result = if block329[0] == 0 || result == 0 then 0 else 1 fi
    block330 = validate_block_header(reference_target, block329[1..3], intermediate_blocks[1645..1650])
    result = if block330[0] == 0 || result == 0 then 0 else 1 fi
    block331 = validate_block_header(reference_target, block330[1..3], intermediate_blocks[1650..1655])
    result = if block331[0] == 0 || result == 0 then 0 else 1 fi
    block332 = validate_block_header(reference_target, block331[1..3], intermediate_blocks[1655..1660])
    result = if block332[0] == 0 || result == 0 then 0 else 1 fi
    block333 = validate_block_header(reference_target, block332[1..3], intermediate_blocks[1660..1665])
    result = if block333[0] == 0 || result == 0 then 0 else 1 fi
    block334 = validate_block_header(reference_target, block333[1..3], intermediate_blocks[1665..1670])
    result = if block334[0] == 0 || result == 0 then 0 else 1 fi
    block335 = validate_block_header(reference_target, block334[1..3], intermediate_blocks[1670..1675])
    result = if block335[0] == 0 || result == 0 then 0 else 1 fi
    block336 = validate_block_header(reference_target, block335[1..3], intermediate_blocks[1675..1680])
    result = if block336[0] == 0 || result == 0 then 0 else 1 fi
    block337 = validate_block_header(reference_target, block336[1..3], intermediate_blocks[1680..1685])
    result = if block337[0] == 0 || result == 0 then 0 else 1 fi
    block338 = validate_block_header(reference_target, block337[1..3], intermediate_blocks[1685..1690])
    result = if block338[0] == 0 || result == 0 then 0 else 1 fi
    block339 = validate_block_header(reference_target, block338[1..3], intermediate_blocks[1690..1695])
    result = if block339[0] == 0 || result == 0 then 0 else 1 fi
    block340 = validate_block_header(reference_target, block339[1..3], intermediate_blocks[1695..1700])
    result = if block340[0] == 0 || result == 0 then 0 else 1 fi
    block341 = validate_block_header(reference_target, block340[1..3], intermediate_blocks[1700..1705])
    result = if block341[0] == 0 || result == 0 then 0 else 1 fi
    block342 = validate_block_header(reference_target, block341[1..3], intermediate_blocks[1705..1710])
    result = if block342[0] == 0 || result == 0 then 0 else 1 fi
    block343 = validate_block_header(reference_target, block342[1..3], intermediate_blocks[1710..1715])
    result = if block343[0] == 0 || result == 0 then 0 else 1 fi
    block344 = validate_block_header(reference_target, block343[1..3], intermediate_blocks[1715..1720])
    result = if block344[0] == 0 || result == 0 then 0 else 1 fi
    block345 = validate_block_header(reference_target, block344[1..3], intermediate_blocks[1720..1725])
    result = if block345[0] == 0 || result == 0 then 0 else 1 fi
    block346 = validate_block_header(reference_target, block345[1..3], intermediate_blocks[1725..1730])
    result = if block346[0] == 0 || result == 0 then 0 else 1 fi
    block347 = validate_block_header(reference_target, block346[1..3], intermediate_blocks[1730..1735])
    result = if block347[0] == 0 || result == 0 then 0 else 1 fi
    block348 = validate_block_header(reference_target, block347[1..3], intermediate_blocks[1735..1740])
    result = if block348[0] == 0 || result == 0 then 0 else 1 fi
    block349 = validate_block_header(reference_target, block348[1..3], intermediate_blocks[1740..1745])
    result = if block349[0] == 0 || result == 0 then 0 else 1 fi
    block350 = validate_block_header(reference_target, block349[1..3], intermediate_blocks[1745..1750])
    result = if block350[0] == 0 || result == 0 then 0 else 1 fi
    block351 = validate_block_header(reference_target, block350[1..3], intermediate_blocks[1750..1755])
    result = if block351[0] == 0 || result == 0 then 0 else 1 fi
    block352 = validate_block_header(reference_target, block351[1..3], intermediate_blocks[1755..1760])
    result = if block352[0] == 0 || result == 0 then 0 else 1 fi
    block353 = validate_block_header(reference_target, block352[1..3], intermediate_blocks[1760..1765])
    result = if block353[0] == 0 || result == 0 then 0 else 1 fi
    block354 = validate_block_header(reference_target, block353[1..3], intermediate_blocks[1765..1770])
    result = if block354[0] == 0 || result == 0 then 0 else 1 fi
    block355 = validate_block_header(reference_target, block354[1..3], intermediate_blocks[1770..1775])
    result = if block355[0] == 0 || result == 0 then 0 else 1 fi
    block356 = validate_block_header(reference_target, block355[1..3], intermediate_blocks[1775..1780])
    result = if block356[0] == 0 || result == 0 then 0 else 1 fi
    block357 = validate_block_header(reference_target, block356[1..3], intermediate_blocks[1780..1785])
    result = if block357[0] == 0 || result == 0 then 0 else 1 fi
    block358 = validate_block_header(reference_target, block357[1..3], intermediate_blocks[1785..1790])
    result = if block358[0] == 0 || result == 0 then 0 else 1 fi
    block359 = validate_block_header(reference_target, block358[1..3], intermediate_blocks[1790..1795])
    result = if block359[0] == 0 || result == 0 then 0 else 1 fi
    block360 = validate_block_header(reference_target, block359[1..3], intermediate_blocks[1795..1800])
    result = if block360[0] == 0 || result == 0 then 0 else 1 fi
    block361 = validate_block_header(reference_target, block360[1..3], intermediate_blocks[1800..1805])
    result = if block361[0] == 0 || result == 0 then 0 else 1 fi
    block362 = validate_block_header(reference_target, block361[1..3], intermediate_blocks[1805..1810])
    result = if block362[0] == 0 || result == 0 then 0 else 1 fi
    block363 = validate_block_header(reference_target, block362[1..3], intermediate_blocks[1810..1815])
    result = if block363[0] == 0 || result == 0 then 0 else 1 fi
    block364 = validate_block_header(reference_target, block363[1..3], intermediate_blocks[1815..1820])
    result = if block364[0] == 0 || result == 0 then 0 else 1 fi
    block365 = validate_block_header(reference_target, block364[1..3], intermediate_blocks[1820..1825])
    result = if block365[0] == 0 || result == 0 then 0 else 1 fi
    block366 = validate_block_header(reference_target, block365[1..3], intermediate_blocks[1825..1830])
    result = if block366[0] == 0 || result == 0 then 0 else 1 fi
    block367 = validate_block_header(reference_target, block366[1..3], intermediate_blocks[1830..1835])
    result = if block367[0] == 0 || result == 0 then 0 else 1 fi
    block368 = validate_block_header(reference_target, block367[1..3], intermediate_blocks[1835..1840])
    result = if block368[0] == 0 || result == 0 then 0 else 1 fi
    block369 = validate_block_header(reference_target, block368[1..3], intermediate_blocks[1840..1845])
    result = if block369[0] == 0 || result == 0 then 0 else 1 fi
    block370 = validate_block_header(reference_target, block369[1..3], intermediate_blocks[1845..1850])
    result = if block370[0] == 0 || result == 0 then 0 else 1 fi
    block371 = validate_block_header(reference_target, block370[1..3], intermediate_blocks[1850..1855])
    result = if block371[0] == 0 || result == 0 then 0 else 1 fi
    block372 = validate_block_header(reference_target, block371[1..3], intermediate_blocks[1855..1860])
    result = if block372[0] == 0 || result == 0 then 0 else 1 fi
    block373 = validate_block_header(reference_target, block372[1..3], intermediate_blocks[1860..1865])
    result = if block373[0] == 0 || result == 0 then 0 else 1 fi
    block374 = validate_block_header(reference_target, block373[1..3], intermediate_blocks[1865..1870])
    result = if block374[0] == 0 || result == 0 then 0 else 1 fi
    block375 = validate_block_header(reference_target, block374[1..3], intermediate_blocks[1870..1875])
    result = if block375[0] == 0 || result == 0 then 0 else 1 fi
    block376 = validate_block_header(reference_target, block375[1..3], intermediate_blocks[1875..1880])
    result = if block376[0] == 0 || result == 0 then 0 else 1 fi
    block377 = validate_block_header(reference_target, block376[1..3], intermediate_blocks[1880..1885])
    result = if block377[0] == 0 || result == 0 then 0 else 1 fi
    block378 = validate_block_header(reference_target, block377[1..3], intermediate_blocks[1885..1890])
    result = if block378[0] == 0 || result == 0 then 0 else 1 fi
    block379 = validate_block_header(reference_target, block378[1..3], intermediate_blocks[1890..1895])
    result = if block379[0] == 0 || result == 0 then 0 else 1 fi
    block380 = validate_block_header(reference_target, block379[1..3], intermediate_blocks[1895..1900])
    result = if block380[0] == 0 || result == 0 then 0 else 1 fi
    block381 = validate_block_header(reference_target, block380[1..3], intermediate_blocks[1900..1905])
    result = if block381[0] == 0 || result == 0 then 0 else 1 fi
    block382 = validate_block_header(reference_target, block381[1..3], intermediate_blocks[1905..1910])
    result = if block382[0] == 0 || result == 0 then 0 else 1 fi
    block383 = validate_block_header(reference_target, block382[1..3], intermediate_blocks[1910..1915])
    result = if block383[0] == 0 || result == 0 then 0 else 1 fi
    block384 = validate_block_header(reference_target, block383[1..3], intermediate_blocks[1915..1920])
    result = if block384[0] == 0 || result == 0 then 0 else 1 fi
    block385 = validate_block_header(reference_target, block384[1..3], intermediate_blocks[1920..1925])
    result = if block385[0] == 0 || result == 0 then 0 else 1 fi
    block386 = validate_block_header(reference_target, block385[1..3], intermediate_blocks[1925..1930])
    result = if block386[0] == 0 || result == 0 then 0 else 1 fi
    block387 = validate_block_header(reference_target, block386[1..3], intermediate_blocks[1930..1935])
    result = if block387[0] == 0 || result == 0 then 0 else 1 fi
    block388 = validate_block_header(reference_target, block387[1..3], intermediate_blocks[1935..1940])
    result = if block388[0] == 0 || result == 0 then 0 else 1 fi
    block389 = validate_block_header(reference_target, block388[1..3], intermediate_blocks[1940..1945])
    result = if block389[0] == 0 || result == 0 then 0 else 1 fi
    block390 = validate_block_header(reference_target, block389[1..3], intermediate_blocks[1945..1950])
    result = if block390[0] == 0 || result == 0 then 0 else 1 fi
    block391 = validate_block_header(reference_target, block390[1..3], intermediate_blocks[1950..1955])
    result = if block391[0] == 0 || result == 0 then 0 else 1 fi
    block392 = validate_block_header(reference_target, block391[1..3], intermediate_blocks[1955..1960])
    result = if block392[0] == 0 || result == 0 then 0 else 1 fi
    block393 = validate_block_header(reference_target, block392[1..3], intermediate_blocks[1960..1965])
    result = if block393[0] == 0 || result == 0 then 0 else 1 fi
    block394 = validate_block_header(reference_target, block393[1..3], intermediate_blocks[1965..1970])
    result = if block394[0] == 0 || result == 0 then 0 else 1 fi
    block395 = validate_block_header(reference_target, block394[1..3], intermediate_blocks[1970..1975])
    result = if block395[0] == 0 || result == 0 then 0 else 1 fi
    block396 = validate_block_header(reference_target, block395[1..3], intermediate_blocks[1975..1980])
    result = if block396[0] == 0 || result == 0 then 0 else 1 fi
    block397 = validate_block_header(reference_target, block396[1..3], intermediate_blocks[1980..1985])
    result = if block397[0] == 0 || result == 0 then 0 else 1 fi
    block398 = validate_block_header(reference_target, block397[1..3], intermediate_blocks[1985..1990])
    result = if block398[0] == 0 || result == 0 then 0 else 1 fi
    block399 = validate_block_header(reference_target, block398[1..3], intermediate_blocks[1990..1995])
    result = if block399[0] == 0 || result == 0 then 0 else 1 fi
    block400 = validate_block_header(reference_target, block399[1..3], intermediate_blocks[1995..2000])
    result = if block400[0] == 0 || result == 0 then 0 else 1 fi
    block401 = validate_block_header(reference_target, block400[1..3], intermediate_blocks[2000..2005])
    result = if block401[0] == 0 || result == 0 then 0 else 1 fi
    block402 = validate_block_header(reference_target, block401[1..3], intermediate_blocks[2005..2010])
    result = if block402[0] == 0 || result == 0 then 0 else 1 fi
    block403 = validate_block_header(reference_target, block402[1..3], intermediate_blocks[2010..2015])
    result = if block403[0] == 0 || result == 0 then 0 else 1 fi
    block404 = validate_block_header(reference_target, block403[1..3], intermediate_blocks[2015..2020])
    result = if block404[0] == 0 || result == 0 then 0 else 1 fi
    block405 = validate_block_header(reference_target, block404[1..3], intermediate_blocks[2020..2025])
    result = if block405[0] == 0 || result == 0 then 0 else 1 fi
    block406 = validate_block_header(reference_target, block405[1..3], intermediate_blocks[2025..2030])
    result = if block406[0] == 0 || result == 0 then 0 else 1 fi
    block407 = validate_block_header(reference_target, block406[1..3], intermediate_blocks[2030..2035])
    result = if block407[0] == 0 || result == 0 then 0 else 1 fi
    block408 = validate_block_header(reference_target, block407[1..3], intermediate_blocks[2035..2040])
    result = if block408[0] == 0 || result == 0 then 0 else 1 fi
    block409 = validate_block_header(reference_target, block408[1..3], intermediate_blocks[2040..2045])
    result = if block409[0] == 0 || result == 0 then 0 else 1 fi
    block410 = validate_block_header(reference_target, block409[1..3], intermediate_blocks[2045..2050])
    result = if block410[0] == 0 || result == 0 then 0 else 1 fi
    block411 = validate_block_header(reference_target, block410[1..3], intermediate_blocks[2050..2055])
    result = if block411[0] == 0 || result == 0 then 0 else 1 fi
    block412 = validate_block_header(reference_target, block411[1..3], intermediate_blocks[2055..2060])
    result = if block412[0] == 0 || result == 0 then 0 else 1 fi
    block413 = validate_block_header(reference_target, block412[1..3], intermediate_blocks[2060..2065])
    result = if block413[0] == 0 || result == 0 then 0 else 1 fi
    block414 = validate_block_header(reference_target, block413[1..3], intermediate_blocks[2065..2070])
    result = if block414[0] == 0 || result == 0 then 0 else 1 fi
    block415 = validate_block_header(reference_target, block414[1..3], intermediate_blocks[2070..2075])
    result = if block415[0] == 0 || result == 0 then 0 else 1 fi
    block416 = validate_block_header(reference_target, block415[1..3], intermediate_blocks[2075..2080])
    result = if block416[0] == 0 || result == 0 then 0 else 1 fi
    block417 = validate_block_header(reference_target, block416[1..3], intermediate_blocks[2080..2085])
    result = if block417[0] == 0 || result == 0 then 0 else 1 fi
    block418 = validate_block_header(reference_target, block417[1..3], intermediate_blocks[2085..2090])
    result = if block418[0] == 0 || result == 0 then 0 else 1 fi
    block419 = validate_block_header(reference_target, block418[1..3], intermediate_blocks[2090..2095])
    result = if block419[0] == 0 || result == 0 then 0 else 1 fi
    block420 = validate_block_header(reference_target, block419[1..3], intermediate_blocks[2095..2100])
    result = if block420[0] == 0 || result == 0 then 0 else 1 fi
    block421 = validate_block_header(reference_target, block420[1..3], intermediate_blocks[2100..2105])
    result = if block421[0] == 0 || result == 0 then 0 else 1 fi
    block422 = validate_block_header(reference_target, block421[1..3], intermediate_blocks[2105..2110])
    result = if block422[0] == 0 || result == 0 then 0 else 1 fi
    block423 = validate_block_header(reference_target, block422[1..3], intermediate_blocks[2110..2115])
    result = if block423[0] == 0 || result == 0 then 0 else 1 fi
    block424 = validate_block_header(reference_target, block423[1..3], intermediate_blocks[2115..2120])
    result = if block424[0] == 0 || result == 0 then 0 else 1 fi
    block425 = validate_block_header(reference_target, block424[1..3], intermediate_blocks[2120..2125])
    result = if block425[0] == 0 || result == 0 then 0 else 1 fi
    block426 = validate_block_header(reference_target, block425[1..3], intermediate_blocks[2125..2130])
    result = if block426[0] == 0 || result == 0 then 0 else 1 fi
    block427 = validate_block_header(reference_target, block426[1..3], intermediate_blocks[2130..2135])
    result = if block427[0] == 0 || result == 0 then 0 else 1 fi
    block428 = validate_block_header(reference_target, block427[1..3], intermediate_blocks[2135..2140])
    result = if block428[0] == 0 || result == 0 then 0 else 1 fi
    block429 = validate_block_header(reference_target, block428[1..3], intermediate_blocks[2140..2145])
    result = if block429[0] == 0 || result == 0 then 0 else 1 fi
    block430 = validate_block_header(reference_target, block429[1..3], intermediate_blocks[2145..2150])
    result = if block430[0] == 0 || result == 0 then 0 else 1 fi
    block431 = validate_block_header(reference_target, block430[1..3], intermediate_blocks[2150..2155])
    result = if block431[0] == 0 || result == 0 then 0 else 1 fi
    block432 = validate_block_header(reference_target, block431[1..3], intermediate_blocks[2155..2160])
    result = if block432[0] == 0 || result == 0 then 0 else 1 fi
    block433 = validate_block_header(reference_target, block432[1..3], intermediate_blocks[2160..2165])
    result = if block433[0] == 0 || result == 0 then 0 else 1 fi
    block434 = validate_block_header(reference_target, block433[1..3], intermediate_blocks[2165..2170])
    result = if block434[0] == 0 || result == 0 then 0 else 1 fi
    block435 = validate_block_header(reference_target, block434[1..3], intermediate_blocks[2170..2175])
    result = if block435[0] == 0 || result == 0 then 0 else 1 fi
    block436 = validate_block_header(reference_target, block435[1..3], intermediate_blocks[2175..2180])
    result = if block436[0] == 0 || result == 0 then 0 else 1 fi
    block437 = validate_block_header(reference_target, block436[1..3], intermediate_blocks[2180..2185])
    result = if block437[0] == 0 || result == 0 then 0 else 1 fi
    block438 = validate_block_header(reference_target, block437[1..3], intermediate_blocks[2185..2190])
    result = if block438[0] == 0 || result == 0 then 0 else 1 fi
    block439 = validate_block_header(reference_target, block438[1..3], intermediate_blocks[2190..2195])
    result = if block439[0] == 0 || result == 0 then 0 else 1 fi
    block440 = validate_block_header(reference_target, block439[1..3], intermediate_blocks[2195..2200])
    result = if block440[0] == 0 || result == 0 then 0 else 1 fi
    block441 = validate_block_header(reference_target, block440[1..3], intermediate_blocks[2200..2205])
    result = if block441[0] == 0 || result == 0 then 0 else 1 fi
    block442 = validate_block_header(reference_target, block441[1..3], intermediate_blocks[2205..2210])
    result = if block442[0] == 0 || result == 0 then 0 else 1 fi
    block443 = validate_block_header(reference_target, block442[1..3], intermediate_blocks[2210..2215])
    result = if block443[0] == 0 || result == 0 then 0 else 1 fi
    block444 = validate_block_header(reference_target, block443[1..3], intermediate_blocks[2215..2220])
    result = if block444[0] == 0 || result == 0 then 0 else 1 fi
    block445 = validate_block_header(reference_target, block444[1..3], intermediate_blocks[2220..2225])
    result = if block445[0] == 0 || result == 0 then 0 else 1 fi
    block446 = validate_block_header(reference_target, block445[1..3], intermediate_blocks[2225..2230])
    result = if block446[0] == 0 || result == 0 then 0 else 1 fi
    block447 = validate_block_header(reference_target, block446[1..3], intermediate_blocks[2230..2235])
    result = if block447[0] == 0 || result == 0 then 0 else 1 fi
    block448 = validate_block_header(reference_target, block447[1..3], intermediate_blocks[2235..2240])
    result = if block448[0] == 0 || result == 0 then 0 else 1 fi
    block449 = validate_block_header(reference_target, block448[1..3], intermediate_blocks[2240..2245])
    result = if block449[0] == 0 || result == 0 then 0 else 1 fi
    block450 = validate_block_header(reference_target, block449[1..3], intermediate_blocks[2245..2250])
    result = if block450[0] == 0 || result == 0 then 0 else 1 fi
    block451 = validate_block_header(reference_target, block450[1..3], intermediate_blocks[2250..2255])
    result = if block451[0] == 0 || result == 0 then 0 else 1 fi
    block452 = validate_block_header(reference_target, block451[1..3], intermediate_blocks[2255..2260])
    result = if block452[0] == 0 || result == 0 then 0 else 1 fi
    block453 = validate_block_header(reference_target, block452[1..3], intermediate_blocks[2260..2265])
    result = if block453[0] == 0 || result == 0 then 0 else 1 fi
    block454 = validate_block_header(reference_target, block453[1..3], intermediate_blocks[2265..2270])
    result = if block454[0] == 0 || result == 0 then 0 else 1 fi
    block455 = validate_block_header(reference_target, block454[1..3], intermediate_blocks[2270..2275])
    result = if block455[0] == 0 || result == 0 then 0 else 1 fi
    block456 = validate_block_header(reference_target, block455[1..3], intermediate_blocks[2275..2280])
    result = if block456[0] == 0 || result == 0 then 0 else 1 fi
    block457 = validate_block_header(reference_target, block456[1..3], intermediate_blocks[2280..2285])
    result = if block457[0] == 0 || result == 0 then 0 else 1 fi
    block458 = validate_block_header(reference_target, block457[1..3], intermediate_blocks[2285..2290])
    result = if block458[0] == 0 || result == 0 then 0 else 1 fi
    block459 = validate_block_header(reference_target, block458[1..3], intermediate_blocks[2290..2295])
    result = if block459[0] == 0 || result == 0 then 0 else 1 fi
    block460 = validate_block_header(reference_target, block459[1..3], intermediate_blocks[2295..2300])
    result = if block460[0] == 0 || result == 0 then 0 else 1 fi
    block461 = validate_block_header(reference_target, block460[1..3], intermediate_blocks[2300..2305])
    result = if block461[0] == 0 || result == 0 then 0 else 1 fi
    block462 = validate_block_header(reference_target, block461[1..3], intermediate_blocks[2305..2310])
    result = if block462[0] == 0 || result == 0 then 0 else 1 fi
    block463 = validate_block_header(reference_target, block462[1..3], intermediate_blocks[2310..2315])
    result = if block463[0] == 0 || result == 0 then 0 else 1 fi
    block464 = validate_block_header(reference_target, block463[1..3], intermediate_blocks[2315..2320])
    result = if block464[0] == 0 || result == 0 then 0 else 1 fi
    block465 = validate_block_header(reference_target, block464[1..3], intermediate_blocks[2320..2325])
    result = if block465[0] == 0 || result == 0 then 0 else 1 fi
    block466 = validate_block_header(reference_target, block465[1..3], intermediate_blocks[2325..2330])
    result = if block466[0] == 0 || result == 0 then 0 else 1 fi
    block467 = validate_block_header(reference_target, block466[1..3], intermediate_blocks[2330..2335])
    result = if block467[0] == 0 || result == 0 then 0 else 1 fi
    block468 = validate_block_header(reference_target, block467[1..3], intermediate_blocks[2335..2340])
    result = if block468[0] == 0 || result == 0 then 0 else 1 fi
    block469 = validate_block_header(reference_target, block468[1..3], intermediate_blocks[2340..2345])
    result = if block469[0] == 0 || result == 0 then 0 else 1 fi
    block470 = validate_block_header(reference_target, block469[1..3], intermediate_blocks[2345..2350])
    result = if block470[0] == 0 || result == 0 then 0 else 1 fi
    block471 = validate_block_header(reference_target, block470[1..3], intermediate_blocks[2350..2355])
    result = if block471[0] == 0 || result == 0 then 0 else 1 fi
    block472 = validate_block_header(reference_target, block471[1..3], intermediate_blocks[2355..2360])
    result = if block472[0] == 0 || result == 0 then 0 else 1 fi
    block473 = validate_block_header(reference_target, block472[1..3], intermediate_blocks[2360..2365])
    result = if block473[0] == 0 || result == 0 then 0 else 1 fi
    block474 = validate_block_header(reference_target, block473[1..3], intermediate_blocks[2365..2370])
    result = if block474[0] == 0 || result == 0 then 0 else 1 fi
    block475 = validate_block_header(reference_target, block474[1..3], intermediate_blocks[2370..2375])
    result = if block475[0] == 0 || result == 0 then 0 else 1 fi
    block476 = validate_block_header(reference_target, block475[1..3], intermediate_blocks[2375..2380])
    result = if block476[0] == 0 || result == 0 then 0 else 1 fi
    block477 = validate_block_header(reference_target, block476[1..3], intermediate_blocks[2380..2385])
    result = if block477[0] == 0 || result == 0 then 0 else 1 fi
    block478 = validate_block_header(reference_target, block477[1..3], intermediate_blocks[2385..2390])
    result = if block478[0] == 0 || result == 0 then 0 else 1 fi
    block479 = validate_block_header(reference_target, block478[1..3], intermediate_blocks[2390..2395])
    result = if block479[0] == 0 || result == 0 then 0 else 1 fi
    block480 = validate_block_header(reference_target, block479[1..3], intermediate_blocks[2395..2400])
    result = if block480[0] == 0 || result == 0 then 0 else 1 fi
    block481 = validate_block_header(reference_target, block480[1..3], intermediate_blocks[2400..2405])
    result = if block481[0] == 0 || result == 0 then 0 else 1 fi
    block482 = validate_block_header(reference_target, block481[1..3], intermediate_blocks[2405..2410])
    result = if block482[0] == 0 || result == 0 then 0 else 1 fi
    block483 = validate_block_header(reference_target, block482[1..3], intermediate_blocks[2410..2415])
    result = if block483[0] == 0 || result == 0 then 0 else 1 fi
    block484 = validate_block_header(reference_target, block483[1..3], intermediate_blocks[2415..2420])
    result = if block484[0] == 0 || result == 0 then 0 else 1 fi
    block485 = validate_block_header(reference_target, block484[1..3], intermediate_blocks[2420..2425])
    result = if block485[0] == 0 || result == 0 then 0 else 1 fi
    block486 = validate_block_header(reference_target, block485[1..3], intermediate_blocks[2425..2430])
    result = if block486[0] == 0 || result == 0 then 0 else 1 fi
    block487 = validate_block_header(reference_target, block486[1..3], intermediate_blocks[2430..2435])
    result = if block487[0] == 0 || result == 0 then 0 else 1 fi
    block488 = validate_block_header(reference_target, block487[1..3], intermediate_blocks[2435..2440])
    result = if block488[0] == 0 || result == 0 then 0 else 1 fi
    block489 = validate_block_header(reference_target, block488[1..3], intermediate_blocks[2440..2445])
    result = if block489[0] == 0 || result == 0 then 0 else 1 fi
    block490 = validate_block_header(reference_target, block489[1..3], intermediate_blocks[2445..2450])
    result = if block490[0] == 0 || result == 0 then 0 else 1 fi
    block491 = validate_block_header(reference_target, block490[1..3], intermediate_blocks[2450..2455])
    result = if block491[0] == 0 || result == 0 then 0 else 1 fi
    block492 = validate_block_header(reference_target, block491[1..3], intermediate_blocks[2455..2460])
    result = if block492[0] == 0 || result == 0 then 0 else 1 fi
    block493 = validate_block_header(reference_target, block492[1..3], intermediate_blocks[2460..2465])
    result = if block493[0] == 0 || result == 0 then 0 else 1 fi
    block494 = validate_block_header(reference_target, block493[1..3], intermediate_blocks[2465..2470])
    result = if block494[0] == 0 || result == 0 then 0 else 1 fi
    block495 = validate_block_header(reference_target, block494[1..3], intermediate_blocks[2470..2475])
    result = if block495[0] == 0 || result == 0 then 0 else 1 fi
    block496 = validate_block_header(reference_target, block495[1..3], intermediate_blocks[2475..2480])
    result = if block496[0] == 0 || result == 0 then 0 else 1 fi
    block497 = validate_block_header(reference_target, block496[1..3], intermediate_blocks[2480..2485])
    result = if block497[0] == 0 || result == 0 then 0 else 1 fi
    block498 = validate_block_header(reference_target, block497[1..3], intermediate_blocks[2485..2490])
    result = if block498[0] == 0 || result == 0 then 0 else 1 fi
    block499 = validate_block_header(reference_target, block498[1..3], intermediate_blocks[2490..2495])
    result = if block499[0] == 0 || result == 0 then 0 else 1 fi
    block500 = validate_block_header(reference_target, block499[1..3], intermediate_blocks[2495..2500])
    result = if block500[0] == 0 || result == 0 then 0 else 1 fi
    block501 = validate_block_header(reference_target, block500[1..3], intermediate_blocks[2500..2505])
    result = if block501[0] == 0 || result == 0 then 0 else 1 fi
    block502 = validate_block_header(reference_target, block501[1..3], intermediate_blocks[2505..2510])
    result = if block502[0] == 0 || result == 0 then 0 else 1 fi
    block503 = validate_block_header(reference_target, block502[1..3], intermediate_blocks[2510..2515])
    result = if block503[0] == 0 || result == 0 then 0 else 1 fi
    //block503 = hash_block_header(intermediate_blocks[2510..2515])
    e = unpack128(final_block[4]) //TODO: Clean up, dirty mirty
    //block504 = validate_block_header(pack128([...[0; 96], ...e[64..96]]), block503[1..3], final_block)
    //block504 = validate_block_header(reference_target, block503[1..3], final_block)
    block504 = validate_block_header(pack128([...[0; 96], ...e[64..96]]), block503[1..3], final_block)
    result = if block504[0] == 0 || result == 0 then 0 else 1 fi

    target_is_valid = validate_target(first_block_epoch[4], intermediate_blocks[2514], final_block[4])
return [result, target_is_valid[0], ...block504[1..3], target_is_valid[1]]
